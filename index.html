<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Rastreo Avanzado - HereACA</title>
    
    <!-- Dependencias externas -->
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet" />
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    
    <!-- Archivos locales -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header Superior -->
    <div id="header">
        <div class="header-left">
            <button class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">
                <i class="fas fa-map-marker-alt logo-icon"></i>
                <span>HereACA Tracker</span>
            </div>
        </div>
        <div class="header-right">
            <div class="status-indicator">
                <div class="status-dot connecting" id="status-dot"></div>
                <span id="status-text">Conectando...</span>
            </div>
        </div>
    </div>

    <!-- Sidebar / Menú Hamburguesa -->
    <div id="sidebar">
        <!-- Sección de Información del Usuario -->
        <div class="sidebar-section">
            <div class="section-title">
                <i class="fas fa-user-circle"></i>
                Información del Usuario
            </div>
            <div class="info-grid">
                <div class="info-card">
                    <i class="fas fa-user" style="color: #3498db;"></i>
                    <div class="info-value" id="user-id">-</div>
                    <div class="info-label">Usuario</div>
                </div>

                <div class="info-card">
                    <i class="fas fa-mobile-alt" style="color: #9b59b6;"></i>
                    <div class="info-value" id="device-info">-</div>
                    <div class="info-label">Dispositivo</div>
                </div>

                <div class="info-card">
                    <i class="fas fa-battery-half" style="color: #2ecc71;"></i>
                    <div class="info-value" id="battery-level">-</div>
                    <div class="info-label">Batería</div>
                    <div class="battery-level">
                        <div class="battery-fill" id="battery-fill" style="width: 0%"></div>
                    </div>
                </div>

                <div class="info-card">
                    <i class="fas fa-bullseye" style="color: #e74c3c;"></i>
                    <div class="info-value" id="accuracy">-</div>
                    <div class="info-label">Precisión</div>
                </div>
            </div>
            <div style="margin-top: 15px; font-size: 12px; color: #666; text-align: center;">
                <i class="fas fa-clock"></i> Actualizado: <span id="last-update">-</span>
            </div>
        </div>

        <!-- Sección de Compartir Ubicación -->
        <div class="sidebar-section">
            <div class="section-title">
                <i class="fas fa-share-alt"></i>
                Compartir Mi Ubicación
            </div>
            <div class="btn-group">
                <button class="btn" id="btn-share-location">
                    <i class="fas fa-share"></i>
                    <div>
                        <div>Compartir Enlace</div>
                        <small>Generar enlace de rastreo</small>
                    </div>
                </button>
                <button class="btn" id="btn-generate-qr">
                    <i class="fas fa-qrcode"></i>
                    <div>
                        <div>Código QR</div>
                        <small>Para compartir fácilmente</small>
                    </div>
                </button>
            </div>
        </div>

        <!-- Sección de Modos de Visualización -->
        <div class="sidebar-section">
            <div class="section-title">
                <i class="fas fa-map-marked-alt"></i>
                Modo de Visualización
            </div>
            <div class="btn-group">
                <button class="btn active" id="btn-live">
                    <i class="fas fa-circle"></i>
                    <div>
                        <div>Tiempo Real</div>
                        <small>Seguimiento en vivo</small>
                    </div>
                </button>
                <button class="btn" id="btn-route">
                    <i class="fas fa-route"></i>
                    <div>
                        <div>Ver Ruta</div>
                        <small>Historial de recorrido</small>
                    </div>
                </button>
                <button class="btn" id="btn-history">
                    <i class="fas fa-history"></i>
                    <div>
                        <div>Historial</div>
                        <small>Ubicaciones anteriores</small>
                    </div>
                </button>
            </div>
        </div>

        <!-- Sección de Geocercas -->
        <div class="sidebar-section">
            <div class="section-title">
                <i class="fas fa-draw-polygon"></i>
                Geocercas
            </div>
            <div class="btn-group">
                <button class="btn" id="btn-add-geofence">
                    <i class="fas fa-plus-circle"></i>
                    <div>
                        <div>Crear Geocerca</div>
                        <small>Dibujar polígono en el mapa</small>
                    </div>
                </button>
                <button class="btn" id="btn-clear-geofences">
                    <i class="fas fa-trash"></i>
                    <div>
                        <div>Limpiar Geocercas</div>
                        <small>Eliminar todas</small>
                    </div>
                </button>
            </div>
        </div>

        <!-- Sección de Rutas -->
        <div class="sidebar-section">
            <div class="section-title">
                <i class="fas fa-road"></i>
                Gestión de Rutas
            </div>
            <div class="btn-group">
                <button class="btn" id="btn-start-recording">
                    <i class="fas fa-record-vinyl"></i>
                    <div>
                        <div>Iniciar Grabación</div>
                        <small>Empezar a grabar ruta</small>
                    </div>
                </button>
                <button class="btn" id="btn-stop-recording">
                    <i class="fas fa-stop"></i>
                    <div>
                        <div>Detener Grabación</div>
                        <small>Parar grabación de ruta</small>
                    </div>
                </button>
                <button class="btn" id="btn-view-routes">
                    <i class="fas fa-list"></i>
                    <div>
                        <div>Ver Rutas Guardadas</div>
                        <small>Mostrar rutas anteriores</small>
                    </div>
                </button>
            </div>
        </div>

        <!-- Sección de Historial -->
        <div class="sidebar-section">
            <div class="section-title">
                <i class="fas fa-list-alt"></i>
                Historial Reciente
            </div>
            <div class="history-list" id="history-list">
                <!-- Los elementos de historial se insertarán aquí -->
            </div>
            <button class="btn" id="btn-clear-history" style="margin-top: 10px;">
                <i class="fas fa-trash"></i> Limpiar Historial
            </button>
        </div>

        <!-- Sección de Configuración -->
        <div class="sidebar-section">
            <div class="section-title">
                <i class="fas fa-cog"></i>
                Configuración
            </div>
            <div class="btn-group">
                <button class="btn" id="btn-night-mode">
                    <i class="fas fa-moon"></i>
                    <div>
                        <div>Modo Noche</div>
                        <small>Alternar tema oscuro</small>
                    </div>
                </button>
                <button class="btn" id="btn-fullscreen">
                    <i class="fas fa-expand"></i>
                    <div>
                        <div>Pantalla Completa</div>
                        <small>Maximizar visualización</small>
                    </div>
                </button>
                <button class="btn" id="btn-debug">
                    <i class="fas fa-terminal"></i>
                    <div>
                        <div>Consola Debug</div>
                        <small>Mostrar/Ocultar logs</small>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Mapa -->
    <div id="map"></div>

    <!-- Controles de dibujo de geocercas -->
    <div class="drawing-controls" id="drawing-controls">
        <div style="font-weight: 600; margin-bottom: 10px; color: var(--dark-color);">Dibujando Geocerca</div>
        <div class="btn-group">
            <button class="btn" id="btn-finish-geofence">
                <i class="fas fa-check"></i>
                <div>
                    <div>Finalizar Geocerca</div>
                    <small>Guardar polígono</small>
                </div>
            </button>
            <button class="btn" id="btn-cancel-geofence">
                <i class="fas fa-times"></i>
                <div>
                    <div>Cancelar</div>
                    <small>Descartar dibujo</small>
                </div>
            </button>
        </div>
        <div class="drawing-info">
            Haz clic en el mapa para añadir puntos al polígono
        </div>
    </div>

    <!-- Panel de Rutas -->
    <div class="routes-panel" id="routes-panel">
        <div style="font-weight: 600; margin-bottom: 15px; color: var(--dark-color);">Rutas Guardadas</div>
        <div id="routes-list">
            <!-- Las rutas se insertarán aquí -->
        </div>
        <button class="btn" id="btn-close-routes" style="margin-top: 15px; width: 100%;">
            <i class="fas fa-times"></i> Cerrar
        </button>
    </div>

    <!-- Controles Flotantes -->
    <div class="floating-controls">
        <button class="floating-btn" id="btn-center-map" title="Centrar en ubicación">
            <i class="fas fa-crosshairs"></i>
        </button>
        <button class="floating-btn" id="btn-zoom-in" title="Acercar">
            <i class="fas fa-plus"></i>
        </button>
        <button class="floating-btn" id="btn-zoom-out" title="Alejar">
            <i class="fas fa-minus"></i>
        </button>
    </div>

    <!-- Panel de Debug -->
    <div id="debug-panel">
        <div class="debug-header">
            <div>Consola de Depuración</div>
            <button class="btn" id="btn-clear-logs" style="padding: 5px 10px; font-size: 12px;">
                <i class="fas fa-trash"></i> Limpiar
            </button>
        </div>
        <div id="debug-logs"></div>
    </div>

    <!-- Modal para crear geocercas -->
    <div id="geofence-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Crear Geocerca</div>
                <button class="close-modal" id="close-geofence-modal">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label" for="geofence-name">Nombre de la geocerca</label>
                <input type="text" id="geofence-name" class="form-input" placeholder="Mi geocerca" value="Mi geocerca">
            </div>
            <div class="form-actions">
                <button class="btn-secondary" id="cancel-geofence">Cancelar</button>
                <button class="btn-primary" id="save-geofence">Guardar Geocerca</button>
            </div>
        </div>
    </div>

    <!-- Modal de confirmación para crear geocerca -->
    <div id="confirmation-modal" class="confirmation-modal">
        <div class="confirmation-content">
            <h3 style="margin-bottom: 15px; color: var(--dark-color);">¿Crear geocerca?</h3>
            <p style="margin-bottom: 20px; color: #666;">¿Deseas guardar esta geocerca con <span id="point-count">0</span> puntos?</p>
            <div class="confirmation-buttons">
                <button class="btn-secondary" id="confirm-cancel">Cancelar</button>
                <button class="btn-primary" id="confirm-save">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal para compartir ubicación -->
    <div id="share-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Compartir Mi Ubicación</div>
                <button class="close-modal" id="close-share-modal">&times;</button>
            </div>

            <div class="share-options">
                <div class="share-option whatsapp" id="share-whatsapp">
                    <i class="fab fa-whatsapp"></i>
                    <div>
                        <div>Compartir por WhatsApp</div>
                        <small>Enviar enlace por WhatsApp</small>
                    </div>
                </div>

                <div class="share-option telegram" id="share-telegram">
                    <i class="fab fa-telegram"></i>
                    <div>
                        <div>Compartir por Telegram</div>
                        <small>Enviar enlace por Telegram</small>
                    </div>
                </div>

                <div class="share-option link" id="share-link">
                    <i class="fas fa-link"></i>
                    <div>
                        <div>Copiar Enlace</div>
                        <small>Copiar URL al portapapeles</small>
                    </div>
                </div>

                <div class="share-option qr" id="share-qr">
                    <i class="fas fa-qrcode"></i>
                    <div>
                        <div>Generar Código QR</div>
                        <small>Mostrar código QR para escanear</small>
                    </div>
                </div>
            </div>

            <div class="share-link-container" id="link-container" style="display: none;">
                <input type="text" class="share-link" id="share-url" readonly>
                <button class="copy-btn" id="copy-link">
                    <i class="fas fa-copy"></i>
                </button>
            </div>

            <div class="qr-code-container" id="qr-container" style="display: none;">
                <canvas id="qr-code"></canvas>
                <p style="margin-top: 10px; font-size: 14px;">Escanea este código para ver mi ubicación en tiempo real</p>
            </div>
        </div>
    </div>

    <!-- Contenedor de notificaciones -->
    <div class="notification-container" id="notification-container"></div>

    <script src="app.js"></script>
</body>
</html>